window.GFDropbox=null,function(a){GFDropbox=function(b){for(var c in b)b.hasOwnProperty(c)&&(this[c]=b[c]);var d=this;this.init=function(){this.createDropboxButton(),this.refreshPreview(),this.setupPreviewBind()},this.createDropboxButton=function(){var b=Dropbox.createChooseButton({extensions:this.extensions,linkType:this.linkType,multiselect:this.multiselect,success:this.uploadHandler});a("#field_"+this.formId+"_"+this.inputId+" .ginput_container").append(b)},this.getFieldValue=function(){var b=a("#input_"+this.formId+"_"+this.inputId).val(); try{b = ?a.parseJSON(b):[];}catch(){b=[]} return b;},this.getFileName=function(a){return a.split("/").pop().split("?dl=").shift()},this.refreshPreview=function(){var b=a("#gform_preview_"+this.formId+"_"+this.inputId),c=d.getFieldValue();for(b.html(""),i=0;i<c.length;i++)file_name=this.getFileName(c[i]),html='<div class="ginput_preview">',html+='<img class="gform_delete" src="'+this.deleteImage+'" alt="'+this.deleteText+'" title="'+this.deleteText+'" data-file="'+file_name+'" /> ',html+="<strong>"+file_name+"</strong>",html+="</div>",b.append(html)},this.removeFile=function(a){var b=this.getFieldValue();for(i=0;i<b.length;i++)name=this.getFileName(b[i]),name===a&&b.splice(i,1);this.setFieldValue(b),this.refreshPreview()},this.setFieldValue=function(b){b=JSON.stringify(b),a("#input_"+this.formId+"_"+this.inputId).val(b)},this.setupPreviewBind=function(){var b=a("#gform_preview_"+this.formId+"_"+this.inputId);a(".ginput_preview img",b).live("click",function(){d.removeFile(a(this).attr("data-file"))})},this.uploadHandler=function(a){var b=d.getFieldValue()&&d.multiselect?d.getFieldValue():[];for(i=0;i<a.length;i++)b.push(a[i].link);d.setFieldValue(b),d.refreshPreview()},this.init()}}(jQuery);
