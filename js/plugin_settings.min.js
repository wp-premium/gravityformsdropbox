window.GFDropboxSettings=null,function(i){GFDropboxSettings=function(){var s=this;this.init=function(){this.initialValues={appKey:this.getAppKey(),appSecret:this.getAppSecret()},this.legacyUI=!i("#customAppKey").parent().hasClass("gform-settings-input__container"),this.pageURL=gform_dropbox_pluginsettings_strings.settings_url,this.bindAppKeyUpdate(),this.bindDeauthorize(),this.bindDisableCustomApp(),this.bindEnableCustomApp(),this.setupValidationIcons(),i("#tab_gravityformsdropbox #gform-settings-save").hide()},this.bindAppKeyUpdate=function(){i("input#customAppKey, input#customAppSecret").on("blur",this.checkAppKeyValidity)},this.bindDeauthorize=function(){i("#gform_dropbox_deauth_button").on("click",function(t){t.preventDefault(),i(this).attr("disabled","disabled"),i.ajax({async:!1,url:ajaxurl,dataType:"json",data:{action:"gfdropbox_deauthorize",nonce:gform_dropbox_pluginsettings_strings.nonce_deauthorize},success:function(t){t.success?window.location.href=s.pageURL:alert(t.data.message),i(this).removeAttr("disabled")}})})},this.bindDisableCustomApp=function(){i("#gform_dropbox_disable_customApp").on("click",function(t){t.preventDefault(),i("input#customAppEnable").val(""),i("#gform-settings-save").trigger("click")})},this.bindEnableCustomApp=function(){i("#gform_dropbox_enable_customApp").on("click",function(t){t.preventDefault(),i("input#customAppEnable").val("1"),i("#gform-settings-save").trigger("click")})},this.checkAppKeyValidity=function(){s.lockAppKeyFields(!0),s.resetAppKeyStatus(),i.ajax({url:ajaxurl,dataType:"json",type:"GET",data:{action:"gfdropbox_valid_app_key_secret",app_key:s.getAppKey(),app_secret:s.getAppSecret(),nonce:gform_dropbox_pluginsettings_strings.nonce_validation},success:function(t){t.success?(s.setAppKeyStatus(t.success,t.data.auth_url),s.lockAppKeyFields(!1)):(t.data&&alert(t.data.message),s.lockAppKeyFields(!1),s.setAppKeyStatus(t.success,null))}})},this.getAppKey=function(){return i("input#customAppKey").val()},this.getAppSecret=function(){return i("input#customAppSecret").val()},this.lockAppKeyFields=function(t){i("input#customAppKey, input#customAppSecret").prop("disabled",t)},this.resetAppKeyStatus=function(){this.legacyUI?i("#gaddon-setting-row-customAppKey .fa, #gaddon-setting-row-customAppSecret .fa").removeClass("icon-check icon-remove fa-check fa-times gf_valid gf_invalid"):i("#gform_setting_customAppKey .gform-settings-field__feedback, #gform_setting_customAppSecret .gform-settings-field__feedback").removeClass("gform-settings-field__feedback--valid gform-settings-field__feedback--invalid")},this.setAppKeyStatus=function(t,e){!0===t&&(window.location.href=s.pageURL),!1===t&&(this.legacyUI?i("#gaddon-setting-row-customAppKey .fa, #gaddon-setting-row-customAppSecret .fa").addClass("icon-remove fa-times gf_invalid"):i("#gform_setting_customAppKey .gform-settings-field__feedback, #gform_setting_customAppSecret .gform-settings-field__feedback").addClass("gform-settings-field__feedback--invalid")),!1!==t&&null!==t||(i("#gform_dropbox_auth_message").show(),i("#gform_dropbox_auth_button").hide())},this.setupValidationIcons=function(){0==i("#gaddon-setting-row-customAppKey .fa").length&&(this.legacyUI?i(' <i class="fa"></i>').insertAfter(i("#customAppKey")):i('<span class="gform-settings-field__feedback" aria-hidden="true"></span>').insertAfter(i("#customAppKey"))),0==i("#gaddon-setting-row-customAppSecret .fa").length&&(this.legacyUI?i(' <i class="fa"></i>').insertAfter(i("#customAppSecret")):i('<span class="gform-settings-field__feedback" aria-hidden="true"></span>').insertAfter(i("#customAppSecret")))},this.init()},i(document).ready(GFDropboxSettings)}(jQuery);